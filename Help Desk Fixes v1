REM === Helpdesk Toolkit (Windows 10/11) ===
REM Requires: Bash Bunny with HID + STORAGE
REM Notes: SFC/DISM may take a while. UAC/admin required for best results.

ATTACKMODE HID STORAGE
LED AMBER
DELAY 6000

REM Open Run dialog
LED BLUE
GUI r
DELAY 400

REM Launch PowerShell as Admin (UAC)
STRING powershell
DELAY 200
CTRL SHIFT ENTER
DELAY 1800

REM Attempt to accept UAC (US keyboard). Add delay + retry to improve focus reliability.
ALT y
DELAY 1200
ALT y
DELAY 800

LED PURPLE

REM === PowerShell: Menu + Remediation + Logging ===
REM We keep it as a single inline command to avoid writing files on the target.

STRING powershell -NoProfile -ExecutionPolicy Bypass -Command "$ErrorActionPreference='Continue'; $ts=Get-Date -Format 'yyyyMMdd_HHmmss'; $hn=$env:COMPUTERNAME; $logDir=Join-Path $env:TEMP ('HelpdeskToolkit_'+$ts); New-Item -ItemType Directory -Path $logDir -Force | Out-Null; $log=Join-Path $logDir ('HelpdeskToolkit_'+$hn+'_'+$ts+'.log'); $summary=Join-Path $logDir ('HelpdeskToolkit_'+$hn+'_'+$ts+'_summary.txt'); function Log($m){$line=('[{0}] {1}' -f (Get-Date -Format 'yyyy-MM-dd HH:mm:ss'),$m); $line | Tee-Object -FilePath $log -Append | Out-Null}; $codes=@{}; function Run($name,[scriptblock]$sb){Log('--- '+$name+' ---'); try{& $sb; $codes[$name]=0; Log($name+': OK')} catch{$codes[$name]=1; Log($name+': FAIL -> '+$_.Exception.Message)}}; Log('Helpdesk Toolkit start'); Log(('User: {0}\{1}' -f $env:USERDOMAIN,$env:USERNAME)); Log(('Admin: {0}' -f ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator))); $choice = Read-Host 'Select issue type: 1=Printer  2=Network  3=Windows Update  4=Run All'; Log('Choice: '+$choice); $support=@{ 'Printer'='https://support.microsoft.com/windows/fix-printer-problems-in-windows-0a2a1a2c-2f1b-4c31-8d4c-3ff6b9d6c1e0'; 'Network'='https://support.microsoft.com/windows/fix-network-connection-issues-in-windows-8192f7b7-4a8a-4a5c-b7c1-2ec4f4f6a3a2'; 'WindowsUpdate'='https://support.microsoft.com/windows/windows-update-troubleshooter-19bc41ca-ad72-ae67-af3c-89ce169755dd' }; $runPrinter = { Run 'Restart Spooler' { Restart-Service -Name Spooler -Force; Start-Sleep -Seconds 2; Get-Service Spooler | Out-String | Add-Content -Path $log } }; $runNetwork = { Run 'Flush DNS' { ipconfig /flushdns | Add-Content -Path $log }; Run 'Renew IP' { ipconfig /release | Add-Content -Path $log; ipconfig /renew | Add-Content -Path $log }; Run 'Reset Winsock' { netsh winsock reset | Add-Content -Path $log }; Run 'Reset IP Stack' { netsh int ip reset | Add-Content -Path $log } }; $runWU = { Run 'Restart Windows Update Service' { Restart-Service -Name wuauserv -Force; Start-Sleep -Seconds 2; Get-Service wuauserv | Out-String | Add-Content -Path $log } }; $runCleanup = { Run 'Clear Temp Files' { $paths=@($env:TEMP,'C:\Windows\Temp'); foreach($p in $paths){ if(Test-Path $p){ Log('Clearing: '+$p); Get-ChildItem -Path $p -Force -ErrorAction SilentlyContinue | Remove-Item -Force -Recurse -ErrorAction SilentlyContinue } }; Log('Temp cleanup attempted') } }; $runHealth = { Run 'SFC' { sfc /scannow | Add-Content -Path $log }; Run 'DISM RestoreHealth' { DISM /Online /Cleanup-Image /RestoreHealth | Add-Content -Path $log } }; $runReports = { Run 'Connectivity Report' { $rep=Join-Path $logDir ('Connectivity_'+$hn+'_'+$ts+'.txt'); '=== ipconfig /all ===' | Out-File $rep -Encoding UTF8; ipconfig /all | Out-File $rep -Append -Encoding UTF8; '=== route print ===' | Out-File $rep -Append -Encoding UTF8; route print | Out-File $rep -Append -Encoding UTF8; '=== DNS cache ===' | Out-File $rep -Append -Encoding UTF8; ipconfig /displaydns | Out-File $rep -Append -Encoding UTF8; '=== Test-NetConnection (8.8.8.8:53) ===' | Out-File $rep -Append -Encoding UTF8; try{ Test-NetConnection 8.8.8.8 -Port 53 | Out-String | Out-File $rep -Append -Encoding UTF8 } catch{ 'Test-NetConnection not available or failed' | Out-File $rep -Append -Encoding UTF8 }; '=== Ping google.com ===' | Out-File $rep -Append -Encoding UTF8; ping -n 4 google.com | Out-File $rep -Append -Encoding UTF8; Log('Connectivity report saved: '+$rep) } }; switch($choice){ '1' { $runPrinter.Invoke(); $runCleanup.Invoke(); Start-Process $support['Printer'] } '2' { $runNetwork.Invoke(); $runCleanup.Invoke(); $runReports.Invoke(); Start-Process $support['Network'] } '3' { $runWU.Invoke(); $runCleanup.Invoke(); Start-Process $support['WindowsUpdate']; $runHealth.Invoke() } Default { $runNetwork.Invoke(); $runPrinter.Invoke(); $runWU.Invoke(); $runCleanup.Invoke(); $runReports.Invoke(); $runHealth.Invoke(); Start-Process $support['Network']; Start-Process $support['Printer']; Start-Process $support['WindowsUpdate'] } }; Log('--- Exit Code Summary ---'); $codes.GetEnumerator() | Sort-Object Name | ForEach-Object { ('{0} = {1}' -f $_.Name,$_.Value) | Tee-Object -FilePath $summary -Append | Out-Null }; Log('Logs at: '+$logDir); try{ $vol=(Get-Volume | Where-Object {$_.FileSystemLabel -match 'BASHBUNNY|Bunny|USB'} | Select-Object -First 1); if($vol){ $dest=('{0}:\loot\HelpdeskToolkit_{1}_{2}' -f $vol.DriveLetter,$hn,$ts); New-Item -ItemType Directory -Path $dest -Force | Out-Null; Copy-Item -Path (Join-Path $logDir '*') -Destination $dest -Recurse -Force; Log('Copied logs to: '+$dest) } else { Log('No Bunny storage volume detected for copy') } } catch { Log('Copy-to-Bunny failed: '+$_.Exception.Message) }; Log('Helpdesk Toolkit complete');"
ENTER

LED GREEN
